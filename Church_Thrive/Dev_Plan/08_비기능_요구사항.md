# 08. 비기능 요구사항

## 성능 요구사항

| 항목 | 목표 | 측정 방법 |
|------|------|-----------|
| API 응답 시간 (p95) | < 200ms | k6 부하 테스트 |
| 페이지 로드 (LCP) | < 2.5초 | Lighthouse |
| 첫 바이트 시간 (TTFB) | < 500ms | WebPageTest |
| STT 처리 시간 | 30분 설교 < 5분 | 실측 |
| 동시 접속자 | 1,000+ (피크) | k6 부하 테스트 |
| 오프라인→온라인 동기화 | < 30초 (100MB 이내) | 실측 |

### 피크 시간 대응

- **일요일 오전 10:00-12:00**: 최대 트래픽 구간
- 오프라인 우선 설계로 서버 부하 분산
- Cloudflare CDN으로 정적 자산 글로벌 배포
- Supabase Realtime 동시 연결 모니터링

---

## 가용성 요구사항

| 항목 | 목표 |
|------|------|
| 전체 가동률 | 99.9% (연 8.76시간 다운타임) |
| 일요일 오전 가동률 | 99.99% (연 52분 다운타임) |
| 계획된 유지보수 | 월~금 새벽 2-4시 |
| 데이터 백업 | 매일 자동 백업 (Supabase) |
| 재해 복구 (RTO) | < 4시간 |
| 데이터 복구 (RPO) | < 1시간 |

---

## 보안 요구사항

### 법규 준수
- **PIPA (개인정보보호법)** 완전 준수
- 개인정보 수집/이용 동의서
- 개인정보 처리방침 게시
- 개인정보 파기 절차 수립

### 데이터 보안

| 계층 | 방안 |
|------|------|
| **전송** | TLS 1.3 (Cloudflare 자동 제공) |
| **저장** | AES-256 암호화 (민감 데이터) |
| **접근** | Supabase RLS + RBAC |
| **인증** | JWT + Refresh Token 로테이션 |
| **API** | Rate Limiting, CORS 설정 |
| **코드** | Snyk 취약점 스캔 |

### 교회 데이터 격리

- Supabase RLS로 `church_id` 기반 **완전 격리**
- 검색/조회/API 모든 레벨에서 교회 간 데이터 차단
- 정기 보안 감사 (분기별)
- 침투 테스트 (연 1회)

### 데이터 소유권

- 교회가 데이터를 **완전히 소유**
- 전체 데이터 내보내기 (JSON/CSV) 기능
- 교회 탈퇴 시 완전 데이터 삭제 옵션
- 삭제 요청 시 30일 유예 후 영구 삭제

---

## 접근성 요구사항

| 항목 | 기준 |
|------|------|
| 표준 | WCAG 2.1 AA 준수 |
| 최소 폰트 크기 | **16px** (고령 교인 대응) |
| 터치 타겟 | 최소 44px x 44px |
| 색상 대비 | 4.5:1 이상 (AA 기준) |
| 폰트 | **Pretendard** (가독성 우수 한글 폰트) |
| 화면 리더 | 주요 기능 aria-label 지원 |
| 키보드 네비게이션 | Tab 키로 모든 기능 접근 가능 |

### 특별 접근성 고려사항

- 60대 이상 교인 비율이 높은 한국 교회 특성 반영
- 큰 버튼, 명확한 아이콘, 간결한 텍스트
- 3탭 이내에 주요 기능 접근 가능
- 전화번호 OTP 로그인 (이메일 미사용 교인 대응)

---

## 오프라인 요구사항

### 오프라인 필수 기능

| 기능 | 오프라인 지원 | 방식 |
|------|-------------|------|
| 설교 녹음 | **필수** | IndexedDB/AsyncStorage |
| 말씀노트 작성 | **필수** | IndexedDB/AsyncStorage |
| 출석 체크 | **필수** | 로컬 큐 → 동기화 |
| 교인 검색 | **우선** | 로컬 캐시 |
| 공지 확인 | **우선** | Service Worker 캐시 |
| 성경 읽기 | **우선** | 미리 다운로드 |

### 동기화 전략

- **오프라인 저장**: Service Worker + IndexedDB (Dexie.js) / AsyncStorage
- **자동 동기화**: Background Sync로 연결 복원 시 자동 업로드
- **충돌 해결**: Last-Write-Wins + UI 머지 프롬프트 (중요 데이터)
- **저장 용량**: 최대 500MB 로컬 저장 (오디오 포함)

---

## 호환성 요구사항

### 웹 (PWA)

| 브라우저 | 최소 버전 |
|---------|----------|
| Chrome | 90+ |
| Safari | 15+ |
| Samsung Internet | 15+ |
| Edge | 90+ |
| Firefox | 90+ |

### 모바일 (React Native)

| OS | 최소 버전 |
|-----|----------|
| iOS | 15.0+ |
| Android | 8.0 (API 26)+ |

### 디바이스 타겟

- **최소 사양**: Samsung Galaxy A시리즈 (2020년 이후)
- **권장 사양**: Galaxy S21 / iPhone 12 이상
- **화면 크기**: 320px ~ 1920px 반응형 지원

---

## 확장성 요구사항

| 항목 | 초기 (500교회) | 중기 (2,000교회) | 장기 (5,000교회) |
|------|---------------|-----------------|-----------------|
| DB 크기 | ~100MB | ~500MB | ~2GB |
| Storage | ~500MB | ~5GB | ~50GB |
| MAU | ~5,000 | ~25,000 | ~75,000 |
| 동시접속 | ~100 | ~500 | ~2,000 |
| 월 API 호출 | ~100K | ~500K | ~2M |

### 스케일링 전략

- **초기**: Supabase 무료 티어 (500MB DB, 1GB Storage)
- **중기**: Supabase Pro ($25/월, 8GB DB, 100GB Storage)
- **장기**: Supabase Team ($599/월) 또는 자체 인프라 마이그레이션

---

## 모니터링 & 관측성

| 도구 | 용도 | 비용 |
|------|------|------|
| **Sentry** | 에러 추적, 성능 모니터링 | 무료 (5K 이벤트/월) |
| **Supabase Dashboard** | DB 모니터링, 쿼리 성능 | 무료 (포함) |
| **Cloudflare Analytics** | 트래픽 분석, CDN 성능 | 무료 (포함) |
| **Uptime Robot** | 가동률 모니터링 | 무료 (50 모니터) |

### 알림 설정

- 서비스 다운 시 즉시 알림 (Slack/이메일)
- 에러율 5% 초과 시 알림
- DB 용량 80% 도달 시 알림
- 일요일 오전 특별 모니터링 체제
